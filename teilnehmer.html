<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>Gameshow — Teilnehmer</title>
<style>
html, body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:'Segoe UI',sans-serif;
  background:#0a0612;
  color:#e0caff;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* Top Container */
.top{
  display:grid;
  grid-template-columns:1fr auto 1fr;
  align-items:start;
  gap:16px;
}

/* Frage Box */
.frage-box{
  background:#1a0d2e;
  color:#c6a8ff;
  border-radius:35px;
  width:400px;
  height:200px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-size:2rem;
  text-align:center;
  white-space: pre-line;
  padding:20px;
  transition: all 0.8s ease;
  margin-bottom:30px;
}
.frage-box .question{transition: all 0.5s ease;}
.frage-box.shrink .question{font-size:1.2rem;}

/* Runde */
.runde{
  background:#000;
  color:#c6a8ff;
  padding:10px 25px;
  border-radius:25px;
  font-size:1.2rem;
  align-self:center;
  justify-self:center;
  position:relative;
}

/* Mod Box */
.mod-box{
  background:#6a4c8d;
  border-radius:25px;
  width:240px;
  height:180px;
  position:absolute;
  top:0;
  right:0;
  display:flex;
  justify-content:center;
  align-items:center;
}
.mod-label{
  background:#fff;
  color:#9f86ff;
  padding:6px 20px;
  border-radius:20px;
  position:absolute;
  bottom:-20px;
  left:50%;
  transform:translateX(-50%);
  font-size:0.95rem;
  font-weight:bold;
}

/* Spieler Grid */
.spieler-grid{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:20px;
  position:relative;
}
.spieler{
  background:#6a4c8d;
  border-radius:25px;
  height:160px;
  display:flex;
  flex-direction: column;
  justify-content:center;
  align-items:center;
  position:relative;
  padding:10px;
  color:#9f86ff;
}
.spieler-info{
  display:flex;
  align-items:center;
  gap:9px;
  background:#fff;
  color:#fa0c9e;
  border-radius:20px;
  padding:6px 12px;
  font-weight:bold;
  font-size:0.95rem;
  margin-top:195px;
}

/* Kameras Container */
.kameras{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:2000; /* über allen overlays */
}
.cam-box{
  position:absolute;
  border-radius:12px;
  overflow:hidden;
  border:2px solid #9f86ff;
  background:#d8b6ff; /* hell-lila Orientierung */
}
.kameras iframe{
  width:100%;
  height:100%;
  border:none;
}
/* Jede Cam über Spieler/Moderator */
#cam1 { top:50px; left:60px; width:200px; height:150px; }
#cam2 { top:50px; left:380px; width:200px; height:150px; }
#cam3 { top:50px; left:700px; width:200px; height:150px; }
#cam4 { top:50px; left:1020px; width:200px; height:150px; }
#cam5 { top:10px; right:50px; width:200px; height:150px; }

/* Push Buttons */
.push-links{
  position:absolute;
  top:270px;
  left:10px;
  z-index:1001;
  display:flex;
  flex-direction:column;
  gap:5px;
}
.push-links button{
  padding:3px 6px;
  font-size:1.3rem;
  border-radius:6px;
  border:none;
  background:#9f86ff;
  color:#fff;
  cursor:pointer;
}
.push-links button:hover{
  background:#b58cff;
}

/* Antwort Animation */
.answer{
  font-size:1.8rem;
  color:#9f86ff;
  margin-top:10px;
  opacity:0;
  animation: fadeInGlow 1s forwards, pulseGlow 2s infinite alternate;
  text-shadow:0 0 8px #9f86ff,0 0 12px #b58cff;
}
@keyframes fadeInGlow{from{opacity:0;transform: scale(0.9);}to{opacity:1;transform: scale(1);}}
@keyframes pulseGlow{0%{text-shadow:0 0 8px #9f86ff,0 0 12px #b58cff;}100%{text-shadow:0 0 16px #9f86ff,0 0 24px #b58cff;}}

/* ---- Overlay States ---- */
#fakeOverlay{
  position:absolute;
  inset:0;
  background:#220022;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:3rem;
  text-align:center;
  z-index:1000; /* jetzt unter den cams */
  opacity:1;
  pointer-events:auto;
  transition:opacity 0.5s ease;
  color:#ff6699;
}

/* Hacker Screen */
.hackerScreen{
  background:#000!important;
  flex-direction:column;
  color:#0f0;
  font-size:6rem;
  overflow:hidden;
}
.matrix{
  position:absolute;
  inset:0;
  color:#0f0;
  font-family:monospace;
  font-size:24px;
  opacity:0.2;
  white-space:pre;
  pointer-events:none;
  animation: scrollMatrix 6s linear infinite;
  mix-blend-mode:screen;
}
@keyframes scrollMatrix{
  from { transform:translateY(-100%);}
  to   { transform:translateY(100%);}
}
.warning{
  font-size:8rem;
  color:yellow;
  text-shadow:0 0 20px yellow,0 0 40px orange;
  margin-bottom:40px;
  animation: pulseWarn 1s infinite alternate, glitch 0.4s infinite;
}
@keyframes pulseWarn{
  from{transform:scale(1);opacity:0.8;}
  to  {transform:scale(1.2);opacity:1;}
}
.warn-text{
  font-size:2rem;
  color:red;
  text-shadow:0 0 5px red,0 0 10px darkred;
  animation: glitch 0.3s infinite;
  margin-bottom: 20px;
}
@keyframes glitch{
  0% { text-shadow:2px 0 red, -2px 0 blue; }
  25%{ text-shadow:-2px -2px lime,2px 2px red;}
  50%{ text-shadow:2px 2px blue,-2px -2px red;}
  75%{ text-shadow:-2px 2 magenta,2px -2 cyan;}
  100%{ text-shadow:2px 0 red,-2px 0 blue;}
}
.loading{
  font-size:1.5rem;
  color:red;
  margin-top:15px;
  font-family:monospace;
}
.h1{
  font-size: 1rem;
  color: rgb(255, 255, 255);
  margin-top:10px;
  margin-bottom: 10px;
  font-family: monospace;
}

/* Intro Screen */
.introScreen{
  background:#04fb9c;
  flex-direction:column;
  color:#04fb9c;
  font-size:3rem;
  text-align:center;
}
.intro-title{
  font-size:4rem;
  margin-bottom:30px;
  text-shadow:0 0 10px #8c04fb,0 0 20px #8c04fb;
}
.intro-sub{
  font-size:2rem;
  color:#824cae;
}
</style>
</head>
<body>

<div id="fakeOverlay">Are you Ready for it?</div>

<!-- Push Buttons für Teilnehmer -->
<div class="push-links">
  <button onclick="window.open('https://vdo.ninja/?push=Kamera1&room=topappleW','_blank'); this.style.display='none';">Nele</button>
  <button onclick="window.open('https://vdo.ninja/?push=Kamera2&room=topappleW','_blank'); this.style.display='none';">Vullco</button>
  <button onclick="window.open('https://vdo.ninja/?push=Kamera3&room=topappleW','_blank'); this.style.display='none';">Paya</button>
  <button onclick="window.open('https://vdo.ninja/?push=Kamera4&room=topappleW','_blank'); this.style.display='none';">Lian</button>
  <button onclick="window.open('https://vdo.ninja/?push=Kamera5&room=topappleW','_blank'); this.style.display='none';">Neneli</button>
</div>


<div class="stage-wrapper">
  <div class="stage">
    <div class="top">
      <div class="frage-box" id="frage">
        <div class="question">FRAGEN</div>
      </div>
      <div class="runde">runde: <span id="runde">xy</span></div>
    </div>
    <div class="mod-box">
      <div class="mod-label">Neneli</div>
    </div>

    <div class="spieler-grid">
      <div class="spieler"><div class="spieler-info"><span>Nele</span><span class="score" id="s0">0</span></div></div>
      <div class="spieler"><div class="spieler-info"><span>Vullco</span><span class="score" id="s1">0</span></div></div>
      <div class="spieler"><div class="spieler-info"><span>Paya</span><span class="score" id="s2">0</span></div></div>
      <div class="spieler"><div class="spieler-info"><span>Lian</span><span class="score" id="s3">0</span></div></div>
    </div>
  </div>
</div>

<!-- Kameras über Spielern -->
<div class="kameras">
  <div id="cam1" class="cam-box">
    <iframe src="https://vdo.ninja/?view=Kamera1&room=topappleW&viewonly=true&quality=1080&fps=30&autoplay=true" allow="autoplay; fullscreen"></iframe>
  </div>
  <div id="cam2" class="cam-box">
    <iframe src="https://vdo.ninja/?view=Kamera2&room=topappleW&viewonly=true&quality=1080&fps=30&autoplay=true" allow="autoplay; fullscreen"></iframe>
  </div>
  <div id="cam3" class="cam-box">
    <iframe src="https://vdo.ninja/?view=Kamera3&room=topappleW&viewonly=true&quality=1080&fps=30&autoplay=true" allow="autoplay; fullscreen"></iframe>
  </div>
  <div id="cam4" class="cam-box">
    <iframe src="https://vdo.ninja/?view=Kamera4&room=topappleW&viewonly=true&quality=1080&fps=30&autoplay=true" allow="autoplay; fullscreen"></iframe>
  </div>
  <div id="cam5" class="cam-box">
    <iframe src="https://vdo.ninja/?view=Kamera5&room=topappleW&viewonly=true&quality=1080&fps=30&autoplay=true" allow="autoplay; fullscreen"></iframe>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA12xVYrWgvIPmPi4dvpjYwlkopmz-CrSA",
  authDomain: "pssst-ba817.firebaseapp.com",
  projectId: "pssst-ba817",
  storageBucket: "pssst-ba817.firebasestorage.app",
  messagingSenderId: "182141979805",
  appId: "1:182141979805:web:d85619677fe2804e811874"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const stageWrapper = document.querySelector(".stage-wrapper");
const frage=document.getElementById("frage");
const runde=document.getElementById("runde");
const questionDiv=frage.querySelector(".question");
const fakeOverlay=document.getElementById("fakeOverlay");

let matrixDiv, dotsEl;

function scaleStage(){
  const scaleX = window.innerWidth / 1000;
  const scaleY = window.innerHeight / 600;
  const scale = Math.min(scaleX, scaleY);
  stageWrapper.style.transform = `scale(${scale})`;
}
window.addEventListener("resize", scaleStage);
scaleStage();

// Hacker Screen
function buildHackerScreen(){
  fakeOverlay.classList.add("hackerScreen");
  fakeOverlay.innerHTML=`
    <div class="matrix" id="matrix"></div>
    <div class="warning">⚠</div>
    <div class="warn-text">WARNUNG</div>
    <div class="h1">dieses Spiel könnte Ihren PC, oder Ihre Freundschaft belasten...</div>
    <div class="warn-text">SYSTEM ERROR</div>
    <div class="loading">Loading<span id="dots"></span></div>
  `;
  matrixDiv=document.getElementById("matrix");
  dotsEl=document.getElementById("dots");

  function genMatrix(){
    let rows=600, cols=1000;
    let txt="";
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        txt+=Math.random()>0.9?Math.floor(Math.random()*10):" ";
      }
      txt+="\n";
    }
    matrixDiv.textContent=txt;
  }
  setInterval(genMatrix,150);

  let dotCount=0;
  setInterval(()=>{
    dotCount=(dotCount+1)%4;
    dotsEl.textContent=".".repeat(dotCount);
  },300);
}

// Intro Screen
function buildIntroScreen(){
  fakeOverlay.classList.remove("hackerScreen");
  fakeOverlay.classList.add("introScreen");
  fakeOverlay.innerHTML=`
    <div class="intro-title">Wer kennt Nico am besten?</div>
    <div class="intro-sub">Are you NOW Ready for it?..</div>
  `;
}

// Firebase Snapshot für Live-Daten
onSnapshot(doc(db,"games","current"),snap=>{
  if(!snap.exists())return;
  const d=snap.data();
  let state=d.fakeState||1;

  if(state===1){
    fakeOverlay.classList.remove("hackerScreen","introScreen");
    fakeOverlay.style.opacity="1";
    fakeOverlay.textContent="Are you Ready for it...?";
    frage.style.opacity=0;
  } else if(state===2){
    if(!fakeOverlay.classList.contains("hackerScreen")) buildHackerScreen();
    fakeOverlay.style.opacity="1";
    frage.style.opacity=0;
  } else if(state===3){
    buildIntroScreen();
    fakeOverlay.style.opacity="1";
    frage.style.opacity=0;
  } else {
    fakeOverlay.style.opacity="0";
    frage.style.opacity=1;

    const q=d.questions[d.questionIndex]||{};
    if(d.revealed){
      frage.classList.add("shrink");
      questionDiv.style.fontSize="1.2rem";
      if(!frage.querySelector(".answer")){
        const ansDiv=document.createElement("div");
        ansDiv.className="answer";
        ansDiv.textContent=q.answer||"Keine Antwort";
        frage.appendChild(ansDiv);
      } else {
        frage.querySelector(".answer").textContent=q.answer||"Keine Antwort";
      }
    } else{
      frage.classList.remove("shrink");
      questionDiv.style.fontSize="2rem";
      questionDiv.textContent=q.text||"Keine Frage mehr.";
      const ansDiv=frage.querySelector(".answer");
      if(ansDiv) ansDiv.remove();
    }
    runde.textContent=d.roundName||d.questionIndex+1;
    (d.scores||[]).forEach((v,i)=>document.getElementById("s"+i).textContent=v);
  }
});
</script>
</body>
</html>
